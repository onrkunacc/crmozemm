@model HospitalInventoryManagement.Data.Models.Cariler

@{
    ViewData["Title"] = "Cari Detayları";
    Layout = "~/Areas/Invoice/Views/Shared/_Layout.cshtml";

    var faturalar = ViewBag.Faturalar as List<dynamic>; // ViewBag'den listeyi al
}

<div class="container mt-4">
    <h2>Cari Detayları</h2>
    <hr />
    <div class="row">
        <div class="col-md-6">
            <h5>Temel Bilgiler</h5>
            <p><strong>Cari Kodu:</strong> @Model.CariKodu</p>
            <p><strong>Unvan:</strong> @Model.Unvan</p>
            <p><strong>Cari Grubu:</strong> @Model.CariGrubu?.GrupAdi</p>
            <p><strong>Teklif No:</strong> @Model.TeklifNo</p>
            <p><strong>İhale No:</strong> @Model.IhaleNo</p>
            <p><strong>Tevkifat:</strong> @(Model.Tevkifat ? "Evet" : "Hayır")</p>
            <p><strong>İl:</strong> @Model.Il</p>
            <p><strong>İlçe:</strong> @Model.Ilce</p>
        </div>
    </div>

    <hr />

    <h5>Fatura Bilgileri</h5>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Ay</th>
                <th>Fatura Tutarı</th>
                <th>Kapanış Tarihi</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ay in new[]
            {
                 new { AyAdi = "Ocak", AyIndex = 1 },
                 new { AyAdi = "Şubat", AyIndex = 2 },
                 new { AyAdi = "Mart", AyIndex = 3 },
                 new { AyAdi = "Nisan", AyIndex = 4 },
                 new { AyAdi = "Mayıs", AyIndex = 5 },
                 new { AyAdi = "Haziran", AyIndex = 6 },
                 new { AyAdi = "Temmuz", AyIndex = 7 },
                 new { AyAdi = "Ağustos", AyIndex = 8 },
                 new { AyAdi = "Eylül", AyIndex = 9 },
                 new { AyAdi = "Ekim", AyIndex = 10 },
                 new { AyAdi = "Kasım", AyIndex = 11 },
                 new { AyAdi = "Aralık", AyIndex = 12 }
            })
            {
                var fatura = faturalar?.FirstOrDefault(f => f.AyIndex == ay.AyIndex);
                <tr>
                    <td>@ay.AyAdi</td>
                    <td>@(fatura?.Fatura?.Tutar.ToString("C") ?? "Henüz girilmemiş")</td>
                    <td>@(fatura?.Fatura?.KapanisTarihi?.ToString("dd.MM.yyyy") ?? "Belirtilmemiş")</td>
                </tr>
            }
        </tbody>
    </table>

    <a onclick ="window.location.href='/Invoice/Invoice/EditInvoice/@Model.Id';" class="btn btn-primary mt-3"> Fatura Düzenle</a>
    <a href="~/Invoice/Cari/Index" class="btn btn-secondary mt-3">Geri Dön</a>
</div>
